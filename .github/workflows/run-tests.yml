name: Python API Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest requests
    
    - name: Create test file
      run: |
        cat > test_api.py << 'EOF'
        import requests
        import pytest
        
        BASE_URL = "https://jsonplaceholder.typicode.com"
        
        def test_get_user():
            response = requests.get(f"{BASE_URL}/users/1")
            assert response.status_code == 200
            data = response.json()
            assert data["id"] == 1
            assert "name" in data
            print("✓ GET user test passed")
        
        def test_create_user():
            new_user = {
                "name": "John Doe",
                "username": "johndoe",
                "email": "john@example.com"
            }
            response = requests.post(f"{BASE_URL}/users", json=new_user)
            assert response.status_code == 201
            data = response.json()
            assert data["id"] == 11
            print("✓ POST create user test passed")
        
        def test_update_user():
            updated_data = {"name": "Updated Name"}
            response = requests.put(f"{BASE_URL}/users/1", json=updated_data)
            assert response.status_code == 200
            data = response.json()
            assert data["name"] == "Updated Name"
            print("✓ PUT update user test passed")
        
        if __name__ == "__main__":
            test_get_user()
            test_create_user()
            test_update_user()
            print("\n✅ All tests passed!")
        EOF
    
    - name: Run tests with pytest
      run: |
        python -m pytest test_api.py -v
